<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<title>物联网操作系统AliOS Things 3.3: &gt; ble_host ble_host &lt;br /&gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygenextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="topbanner"><a href="https://github.com/Tencent/rapidjson" title="RapidJSON GitHub"><i class="githublogo"></i></a></div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.9.1 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_2a.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">&gt; ble_host ble_host <br  />
 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md96"></a>
组件概述</h1>
<p>AliOS Things 3.3提供支持符合蓝牙4.0/4.2/5.0核心协议规范的BLE Host软件协议栈组件，方便用户使用蓝牙BLE功能。<br  />
ble_host组件功能框图如下图红色部分:<br  />
<img src="https://img.alicdn.com/imgextra/i1/O1CN018Gd9qR2ALhGFNkTT9_!!6000000008187-2-tps-830-730.png#align=left&amp;display=inline&amp;height=461&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=922&amp;originWidth=1932&amp;size=259937&amp;status=done&amp;style=none&amp;width=966#align=left&amp;display=inline&amp;height=537&amp;margin=%5Bobject%20Object%5D&amp;originHeight=730&amp;originWidth=830&amp;status=done&amp;style=none&amp;width=611#align=left&amp;display=inline&amp;height=730&amp;margin=%5Bobject%20Object%5D&amp;originHeight=730&amp;originWidth=830&amp;status=done&amp;style=none&amp;width=830" alt="image.png" class="inline"/><br  />
</p>
<h2><a class="anchor" id="autotoc_md97"></a>
功能支持</h2>
<p>ble_host组件主要支持如下功能：</p>
<ul>
<li>Generic Access Profile(GAP)角色支持<ul>
<li>Peripheral&amp;Central</li>
<li>Observer&amp;Broadcaster</li>
</ul>
</li>
<li>Generic Attribute Profile(GATT)连接支持<ul>
<li>GATT client</li>
<li>GATT server</li>
</ul>
</li>
<li>Security Manager(SM)支持<ul>
<li>Legacy Pairing</li>
<li>多安全等级设定Security Level 1, 2, 3, 4</li>
<li>安全连接Security Connection</li>
<li>LE Privacy(RPA地址生成)</li>
</ul>
</li>
<li>HCI接口支持<ul>
<li>标准HCI接口，支持host-only，host通过HCI硬件接口（以UART为主）和controller对接</li>
<li>虚拟HCI接口，支持host+controller，适合SoC的硬件平台</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md98"></a>
版权说明</h2>
<blockquote class="doxtable">
<p>Apache license v2.0 </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md99"></a>
目录结构</h2>
<div class="fragment"><div class="line">|-- ble_profiles             #BLE服务</div>
<div class="line">|-- bt_crypto                #BLE安全</div>
<div class="line">|-- bt_defconfig             #BLE配置项</div>
<div class="line">|-- bt_host                  #BLE Host核心代码</div>
<div class="line">|-- bt_preconfig             #BLE预配置项</div>
<div class="line">|-- bt_shell                 #BLE控制台命令</div>
<div class="line">|-- include                  #头文件</div>
<div class="line">|-- package.yaml             #makefile</div>
<div class="line">|-- README.md                #README文档</div>
<div class="line">|-- SConscript</div>
<div class="line">|-- script</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md100"></a>
依赖组件</h2>
<ul>
<li>osal_aos</li>
</ul>
<h1><a class="anchor" id="autotoc_md101"></a>
常用配置</h1>
<h2><a class="anchor" id="autotoc_md102"></a>
配置列表</h2>
<p>配置在组件的package.yaml中定义，均已默认打开，用户可根据需求裁剪。</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">CONFIG_BT_CENTRAL   </th><th class="markdownTableHeadLeft">BLE Central角色功能开关    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">CONFIG_BT_PERIPHERAL   </td><td class="markdownTableBodyLeft">BLE 外设角色功能开关    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">CONFIG_BT_SMP   </td><td class="markdownTableBodyLeft">BLE SMP功能开关    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">CONFIG_BT_GATT_CLIENT   </td><td class="markdownTableBodyLeft">BLE GATT Client功能开关    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">CONFIG_BT_OBSERVER   </td><td class="markdownTableBodyLeft">BLE 广播扫描功能开关   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md103"></a>
API介绍</h1>
<h2><a class="anchor" id="autotoc_md104"></a>
API列表</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">ble_stack_init   </th><th class="markdownTableHeadLeft">BLE协议栈初始化    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ble_stack_event_register   </td><td class="markdownTableBodyLeft">注册BLE事件处理函数    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">ble_stack_adv_start   </td><td class="markdownTableBodyLeft">BLE 广播开始    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ble_stack_adv_stop   </td><td class="markdownTableBodyLeft">BLE 广播停止    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">ble_stack_scan_start   </td><td class="markdownTableBodyLeft">BLE 扫描开始    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ble_stack_scan_stop   </td><td class="markdownTableBodyLeft">BLE 扫描停止    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">ble_stack_gatt_mtu_get   </td><td class="markdownTableBodyLeft">GATT，获取当前连接MTU大小    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ble_stack_gatt_registe_service   </td><td class="markdownTableBodyLeft">GATT server，服务注册    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">ble_stack_gatt_notificate   </td><td class="markdownTableBodyLeft">GATT server，属性notificate方式上报    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ble_stack_gatt_indicate   </td><td class="markdownTableBodyLeft">GATT server，属性indicate方式上报    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">ble_stack_gatt_mtu_exchange   </td><td class="markdownTableBodyLeft">GATT client，协商MTU大小    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ble_stack_gatt_discovery   </td><td class="markdownTableBodyLeft">GATT client，发现对端GATT服务    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">ble_stack_gatt_read   </td><td class="markdownTableBodyLeft">GATT client，读取对端GATT server属性    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ble_stack_gatt_read_multiple   </td><td class="markdownTableBodyLeft">GATT client，读取对端GATT server多个属性    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">ble_stack_gatt_write   </td><td class="markdownTableBodyLeft">GATT client，写入对端GATT server属性    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ble_stack_connect   </td><td class="markdownTableBodyLeft">开始BLE连接    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">ble_stack_disconnect   </td><td class="markdownTableBodyLeft">断开BLE连接    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ble_stack_connect_param_update   </td><td class="markdownTableBodyLeft">BLE连接参数协商    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">ble_stack_security   </td><td class="markdownTableBodyLeft">BLE连接安全等级设置    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ble_stack_iocapability_set   </td><td class="markdownTableBodyLeft">BLE SMP IO能力配置    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">ble_stack_smp_cancel   </td><td class="markdownTableBodyLeft">BLE SMP配对请求取消    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ble_stack_smp_passkey_entry   </td><td class="markdownTableBodyLeft">BLE SMP passkey输入    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">ble_stack_smp_passkey_confirm   </td><td class="markdownTableBodyLeft">BLE SMP passkey确认    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">ble_stack_dev_unpair   </td><td class="markdownTableBodyLeft">PIN SMP配对解绑   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md105"></a>
API详情</h2>
<h3><a class="anchor" id="autotoc_md106"></a>
ble_stack_init</h3>
<p>BLE模块初始化。<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_init(init_param_t *param)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">param.dev_name   </td><td class="markdownTableBodyLeft">设备名，string类型，不超过28字符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">param.dev_addr   </td><td class="markdownTableBodyLeft">设备mac地址，仅设置为random类型时生效    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">param.conn_num_max   </td><td class="markdownTableBodyLeft">最大连接数   </td></tr>
</table>
<p><b>返回参数</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md107"></a>
ble_stack_event_register</h3>
<p>注册BLE协议栈事件回调函数。<br  />
注意：入参不能是一个局部变量。<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_event_register(ble_event_cb_t *callback)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">callback.callback   </td><td class="markdownTableBodyLeft">回调函数    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">callback.next   </td><td class="markdownTableBodyLeft">无需填写，由API函数处理   </td></tr>
</table>
<p><b>返回参数</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md108"></a>
ble_stack_adv_start</h3>
<p>打开BLE广播功能。<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_adv_start(adv_param_t *param)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">param.type   </td><td class="markdownTableBodyLeft">广播类型，定义如下<br  />
&#160; &#160; 0x00&#160; 普通广播<br  />
&#160; &#160; 0x01&#160; 直连广播<br  />
&#160; &#160; 0x02&#160; 可连接可扫描广播<br  />
&#160; &#160; 0x03&#160; 不可连接广播,<br  />
&#160; &#160; 0x04&#160; 低占空直连广播    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">param.ad   </td><td class="markdownTableBodyLeft">ADV广播内容数组    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">param.sd   </td><td class="markdownTableBodyLeft">Scan Response广播内容数组    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">param.ad_num   </td><td class="markdownTableBodyLeft">ADV广播内容数组大小    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">param.sd_num   </td><td class="markdownTableBodyLeft">Scan Response广播内容数组大小    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">param.interval_min   </td><td class="markdownTableBodyLeft">广播发送间隔最小值    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">param.interval_max   </td><td class="markdownTableBodyLeft">广播发送间隔最大值    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">param.filter_policy   </td><td class="markdownTableBodyLeft">广播过滤开关，定义如下<br  />
&#160; &#160; 0x00&#160; 接受所有连接与扫描请求<br  />
&#160; &#160; 0x01&#160; 接受所有连接请求，接受白名单设备的扫描请求<br  />
&#160; &#160; 0x02&#160; 接受白名单的连接请求，接受所有扫描请求<br  />
&#160; &#160; 0x03&#160; 仅接受白名单内的扫描与连接请求    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">param.channel_map   </td><td class="markdownTableBodyLeft">广播信道设置，<br  />
&#160; &#160; bit0: 37信道<br  />
&#160; &#160; bit1: 38信道<br  />
&#160; &#160; bit2: 39信道    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">param.direct_peer_addr   </td><td class="markdownTableBodyLeft">直连广播设备地址，仅在广播类型为直连类型时才生效   </td></tr>
</table>
<p><b>返回参数</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md109"></a>
ble_stack_adv_stop</h3>
<p>关闭BLE广播功能。<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_adv_stop()</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">无   </td><td class="markdownTableBodyLeft"></td></tr>
</table>
<p><b>返回参数</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md110"></a>
ble_stack_scan_start</h3>
<p>打开BLE扫描功能。<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_scan_start(const scan_param_t *param)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">param.type   </td><td class="markdownTableBodyLeft">扫描类型，定义如下<br  />
&#160; &#160;&#160;0x00&#160; 被动扫描<br  />
&#160; &#160; 0x01&#160; &#160;主动扫描    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">param.filter_dup   </td><td class="markdownTableBodyLeft">重复设备上报过滤开关，定义如下<br  />
&#160; &#160; 0x00&#160; 关闭过滤<br  />
&#160; &#160; 0x01&#160; 开启过滤    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">param.interval   </td><td class="markdownTableBodyLeft">扫描间隔，单位为0.625毫秒    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">param.window   </td><td class="markdownTableBodyLeft">扫描窗大小，单位为0.625毫秒    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">param.scan_filter   </td><td class="markdownTableBodyLeft">扫描过滤类型，定义如下<br  />
&#160; &#160; 0x00&#160; 所有广播均上报<br  />
&#160; &#160; 0x01&#160; 仅白名单设备的广播上报   </td></tr>
</table>
<p><b>返回参数</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md111"></a>
ble_stack_scan_stop</h3>
<p>关闭BLE扫描功能。<br  />
异步事件，扫描结果在注册的事件回调函数中返回，返回事件EVENT_GAP_DEV_FIND<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_scan_stop()</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">无   </td><td class="markdownTableBodyLeft"></td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md112"></a>
ble_stack_gatt_mtu_get</h3>
<p>获取一个连接的当前MTU大小<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_gatt_mtu_get(int16_t conn_handle)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">conn_handle   </td><td class="markdownTableBodyLeft">连接句柄，在连接成功后分配   </td></tr>
</table>
<p><b>返回值</b><br  />
23-65535: MTU大小<br  />
</p>
<h3><a class="anchor" id="autotoc_md113"></a>
ble_stack_gatt_registe_service</h3>
<p>注册一个GATT服务<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_gatt_registe_service(gatt_service *s, gatt_attr_t attrs[], uint16_t attr_num)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s.bt_gatt_attr   </td><td class="markdownTableBodyLeft">无需填写，由API赋值    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">s.attr_count   </td><td class="markdownTableBodyLeft">无需填写，由API赋值    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s.node   </td><td class="markdownTableBodyLeft">无需填写，由API赋值    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">attrs   </td><td class="markdownTableBodyLeft">属性列表    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">attr_num   </td><td class="markdownTableBodyLeft">属性列表大小   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md114"></a>
ble_stack_gatt_notificate</h3>
<p>GATT服务某个属性值上报，此上报方式无需GATT Client回复<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_gatt_notificate(int16_t conn_handle, uint16_t char_handle, const uint8_t *data, uint16_t len)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">conn_handle   </td><td class="markdownTableBodyLeft">连接句柄，在连接成功后分配    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">char_handle   </td><td class="markdownTableBodyLeft">属性句柄，在注册服务时分配    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">data   </td><td class="markdownTableBodyLeft">上报数据指针    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">len   </td><td class="markdownTableBodyLeft">上报数据长度   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md115"></a>
ble_stack_gatt_indicate</h3>
<p>GATT服务某个属性值上报，此上报方式GATT Client回复confirm。<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_gatt_indicate(int16_t conn_handle, int16_t char_handle, const uint8_t *data, uint16_t len)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">conn_handle   </td><td class="markdownTableBodyLeft">连接句柄，在连接成功后分配    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">char_handle   </td><td class="markdownTableBodyLeft">属性句柄，在注册服务时分配    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">data   </td><td class="markdownTableBodyLeft">上报数据指针    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">len   </td><td class="markdownTableBodyLeft">上报数据长度   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md116"></a>
ble_stack_gatt_mtu_exchange</h3>
<p>GATT Client功能，确保配置项CONFIG_BT_GATT_CLIENT配置。<br  />
GATT协商MTU大小，协商大小由配置项CONFIG_BT_L2CAP_RX_MTU与CONFIG_BT_L2CAP_TX_MTU的最小值以及对端设备的回复决定。<br  />
异步事件，执行结果在注册的事件回调函数中返回，返回事件EVENT_GATT_MTU_EXCHANGE<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_gatt_mtu_exchange(int16_t conn_handle)</div>
</div><!-- fragment --><p><br  />
<b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">conn_handle   </td><td class="markdownTableBodyLeft">连接句柄，在连接成功后分配   </td></tr>
</table>
<p><br  />
<b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md117"></a>
ble_stack_gatt_discovery</h3>
<p>GATT Client功能，确保配置项CONFIG_BT_GATT_CLIENT配置。<br  />
GATT服务或者属性项发现。<br  />
异步事件，执行结果在注册的事件回调函数中返回，返回事件根据入参不同而不同</p>
<p><b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_gatt_discovery(int16_t conn_handle,</div>
<div class="line">                             gatt_discovery_type_en type,</div>
<div class="line">                             uuid_t *uuid,</div>
<div class="line">                             uint16_t start_handle,</div>
<div class="line">                             uint16_t end_handle)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">conn_handle   </td><td class="markdownTableBodyLeft">连接句柄，在连接成功后分配    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">type   </td><td class="markdownTableBodyLeft">GATT发现类型，定义如下<br  />
&#160; &#160; 0x00&#160; 发现主服务<br  />
&#160; &#160; 0x01&#160; 发现包含服务<br  />
&#160; &#160; 0x02&#160; 发现属性项<br  />
&#160; &#160; 0x03&#160; 发现属性描述项    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">uuid   </td><td class="markdownTableBodyLeft">需要发现的UUID值    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">start_handle   </td><td class="markdownTableBodyLeft">发现起始句柄    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">end_handle   </td><td class="markdownTableBodyLeft">发现结束句柄   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md118"></a>
ble_stack_gatt_read</h3>
<p>GATT Client功能，确保配置项CONFIG_BT_GATT_CLIENT配置。<br  />
GATT读取某个属性项的属性值<br  />
异步事件，执行结果在注册的事件回调函数中返回，返回事件EVENT_GATT_CHAR_READ_CB<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_gatt_read(int16_t conn_handle, uint16_t attr_handle, uint16_t offset)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">conn_handle   </td><td class="markdownTableBodyLeft">连接句柄，在连接成功后分配    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">attr_handle   </td><td class="markdownTableBodyLeft">读取的属性项句柄    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">offset   </td><td class="markdownTableBodyLeft">读取起始位置   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md119"></a>
ble_stack_gatt_read_multiple</h3>
<p>GATT Client功能，确保配置项CONFIG_BT_GATT_CLIENT配置。<br  />
GATT读取多个属性项的属性值<br  />
异步事件，执行结果在注册的事件回调函数中返回，返回事件EVENT_GATT_CHAR_READ_CB<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_gatt_read_multiple(int16_t conn_handle, uint16_t attr_count, uint16_t attr_handle[])</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">conn_handle   </td><td class="markdownTableBodyLeft">连接句柄，在连接成功后分配    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">attr_count   </td><td class="markdownTableBodyLeft">读取的属性项列表大小    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">attr_handle   </td><td class="markdownTableBodyLeft">读取的属性项句柄列表   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md120"></a>
ble_stack_gatt_write</h3>
<p>GATT Client功能，确保配置项CONFIG_BT_GATT_CLIENT配置。<br  />
GATT写入某个属性项的属性值<br  />
异步事件，执行结果在注册的事件回调函数中返回，返回事件EVENT_GATT_CHAR_WRITE_CB<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_gatt_write(int16_t conn_handle, uint16_t attr_handle, uint8_t *data, uint16_t len, uint16_t offset, gatt_write_en type)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">conn_handle   </td><td class="markdownTableBodyLeft">连接句柄，在连接成功后分配    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">attr_handle   </td><td class="markdownTableBodyLeft">写入的属性项句柄    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">data   </td><td class="markdownTableBodyLeft">写入的数据指针    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">len   </td><td class="markdownTableBodyLeft">写入的数据长度    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">offset   </td><td class="markdownTableBodyLeft">写入到属性项的起始位置    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">type   </td><td class="markdownTableBodyLeft">写入类型，定义如下<br  />
&#160; &#160; 0x00&#160; 带回复写入<br  />
&#160; &#160; 0x01&#160; 不带回复写入<br  />
&#160; &#160; 0x02&#160; 带签名写入   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md121"></a>
ble_stack_gatt_read_multiple</h3>
<p>GATT Client功能，确保配置项CONFIG_BT_GATT_CLIENT配置。<br  />
此函数用于GATT读取多个属性项的属性值。<br  />
异步事件，执行结果在注册的事件回调函数中返回，返回事件EVENT_GATT_CHAR_READ_CB<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_gatt_read_multiple(int16_t conn_handle, uint16_t attr_count, uint16_t attr_handle[])</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">conn_handle   </td><td class="markdownTableBodyLeft">连接句柄，在连接成功后分配    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">attr_count   </td><td class="markdownTableBodyLeft">读取的属性项列表大小    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">attr_handle   </td><td class="markdownTableBodyLeft">读取的属性项句柄列表   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md122"></a>
ble_stack_connect</h3>
<p>BLE连接功能，确保配置项CONFIG_BT_CONN配置。<br  />
此函数用于BLE连接某个设备。<br  />
异步事件，执行结果在注册的事件回调函数中返回，返回事件EVENT_GATT_CONN_CHANGE<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_connect(dev_addr_t *peer_addr, conn_param_t *param, uint8_t auto_connect)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">peer_addr.type   </td><td class="markdownTableBodyLeft">对端设备的地址类型    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">peer_addr.val   </td><td class="markdownTableBodyLeft">对端设备的蓝牙地址    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">param.interval_min   </td><td class="markdownTableBodyLeft">连接间隔最小值参数，单位是0.625毫秒    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">param.interval_max   </td><td class="markdownTableBodyLeft">连接间隔最大值参数，单位是0.625毫秒    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">param.lantency   </td><td class="markdownTableBodyLeft">连接延迟参数，单位是连接间隔，注意此时间长度不能超过timeout参数的一半。    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">param.timeout   </td><td class="markdownTableBodyLeft">连接超时参数，单位10ms   </td></tr>
</table>
<p>| auto_connect | 是否自动连接定义如下<br  />
&#160; &#160; 0x00&#160; 不自动连接<br  />
&#160; &#160; 0x01&#160; 自动连接 | |</p>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md123"></a>
ble_stack_disconnect</h3>
<p>BLE连接功能，确保配置项CONFIG_BT_CONN配置。<br  />
此函数用于BLE断开某个设备的连接。<br  />
异步事件，执行结果在注册的事件回调函数中返回，返回事件EVENT_GATT_CONN_CHANGE<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_disconnect(int16_t conn_handle)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">conn_handle   </td><td class="markdownTableBodyLeft">连接句柄，在连接事件中返回   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md124"></a>
ble_stack_connect_param_update</h3>
<p>BLE连接功能，确保配置项CONFIG_BT_CONN配置。<br  />
此函数用于BLE修改某个连接的连接参数。<br  />
异步事件，执行结果在注册的事件回调函数中返回，返回事件EVENT_GAP_CONN_PARAM_UPDATE<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_connect_param_update(int16_t conn_handle, conn_param_t *param)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">conn_handle   </td><td class="markdownTableBodyLeft">连接句柄，在连接事件中返回    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">param.interval_min   </td><td class="markdownTableBodyLeft">连接间隔最小值参数，单位是0.625毫秒    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">param.interval_max   </td><td class="markdownTableBodyLeft">连接间隔最大值参数，单位是0.625毫秒    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">param.lantency   </td><td class="markdownTableBodyLeft">连接延迟参数，单位是连接间隔，注意此时间长度不能超过timeout参数的一半。    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">param.timeout   </td><td class="markdownTableBodyLeft">连接超时参数，单位10ms   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md125"></a>
ble_stack_security</h3>
<p>BLE连接功能，确保配置项CONFIG_BT_CONN配置。<br  />
此函数用于BLE修改某个连接的安全参数。<br  />
异步事件，执行结果在注册的事件回调函数中返回，返回事件EVENT_GAP_CONN_SECURITY_CHANGE<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_security(int16_t conn_handle, security_en level)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">conn_handle   </td><td class="markdownTableBodyLeft">连接句柄，在连接事件中返回    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">level   </td><td class="markdownTableBodyLeft">安全等级，定义如下<br  />
&#160; &#160; 0x00&#160; 无安全，无加密无鉴权<br  />
&#160; &#160; 0x01&#160; 低安全，等同于0x00<br  />
&#160; &#160; 0x02&#160; 中安全，有加密无鉴权<br  />
&#160; &#160; 0x03&#160; 高安全，有加密有鉴权   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md126"></a>
ble_stack_iocapability_set</h3>
<p>BLE SMP配对功能，确保配置项CONFIG_BT_SMP配置。<br  />
此函数用于设置BLE设备设备的IO能力，这个设置会在BLE SMP配对被使用。<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_iocapability_set(uint8_t io_cap)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">io_cap   </td><td class="markdownTableBodyLeft">IO能力，定义如下<br  />
&#160; &#160; bit0-bit2：<br  />
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 0x01&#160; 无输入<br  />
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 0x02&#160; 输入正确/错误<br  />
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 0x03&#160; 键盘输入<br  />
&#160; &#160; bit3-bit4:<br  />
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 0x00&#160; 无输出<br  />
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 0x01&#160; 显示器输出   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md127"></a>
ble_stack_smp_cancel</h3>
<p>BLE SMP配对功能，确保配置项CONFIG_BT_SMP配置。<br  />
此函数用于取消当前BLE的SMP配对请求。<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_smp_cancel(int16_t conn_handle)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">conn_handle   </td><td class="markdownTableBodyLeft">连接句柄，在连接事件中返回   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md128"></a>
ble_stack_smp_passkey_entry</h3>
<p>BLE SMP配对功能，确保配置项CONFIG_BT_SMP配置。<br  />
此函数用于SMP Passkey模式下输入当前passkey，当接收到EVENT_SMP_PASSKEY_ENTER后调用。<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_smp_passkey_entry(int16_t conn_handle, uint32_t passkey)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">conn_handle   </td><td class="markdownTableBodyLeft">连接句柄，在连接事件中返回    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">passskey   </td><td class="markdownTableBodyLeft">0-999999之间   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md129"></a>
ble_stack_smp_passkey_confirm</h3>
<p>BLE SMP配对功能，确保配置项CONFIG_BT_SMP配置。<br  />
此函数用于SMP Passkey模式下确认当前的passkey是否正确，当接收到EVENT_SMP_PASSKEY_CONFIRM后调用。<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_smp_passkey_confirm(int16_t conn_handle)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">conn_handle   </td><td class="markdownTableBodyLeft">连接句柄，在连接事件中返回   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h3><a class="anchor" id="autotoc_md130"></a>
ble_stack_dev_unpair</h3>
<p>BLE SMP配对功能，确保配置项CONFIG_BT_SMP配置。<br  />
此函数用于解除某台已SMP配对的设备的配对，如果连接存在则断开连接。<br  />
<b>函数原型</b> </p><div class="fragment"><div class="line">int ble_stack_dev_unpair(dev_addr_t *peer_addr)</div>
</div><!-- fragment --><p> <b>输入参数</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">peer_addr.type   </td><td class="markdownTableBodyLeft">地址类型    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">peer_addr.val   </td><td class="markdownTableBodyLeft">设备地址   </td></tr>
</table>
<p><b>返回值</b><br  />
<code>0：</code>成功， <code>其他值</code>：失败。<br  />
</p>
<h1><a class="anchor" id="autotoc_md131"></a>
使用示例</h1>
<h2><a class="anchor" id="autotoc_md132"></a>
案例工具</h2>
<ul>
<li>串口工具</li>
<li>NRF Connect(手机)</li>
</ul>
<h2><a class="anchor" id="autotoc_md133"></a>
案例修改</h2>
<p>以helloworld的案例为例，修改solutions/helloworld_demo/package.yaml的depends，增加ble_host，如下 </p><div class="fragment"><div class="line">depends:</div>
<div class="line">  - ble_host: master</div>
</div><!-- fragment --><p><br  />
修改solutions/helloworld_demo/helloworld_demo.c，如下：<br  />
<b>头文件修改</b> </p><div class="fragment"><div class="line">#include &lt;aos/ble.h&gt;</div>
<div class="line">#include &lt;atomic.h&gt;</div>
<div class="line">#include &lt;bluetooth/bluetooth.h&gt;</div>
<div class="line">#include &lt;bluetooth/gatt.h&gt;</div>
<div class="line">#include &lt;bluetooth/uuid.h&gt;</div>
</div><!-- fragment --><p><br  />
<b>代码修改</b> </p><div class="fragment"><div class="line">#define EXAMPLE_BLE_DEV_NAME        &quot;HaaS BLE&quot;</div>
<div class="line">#define DEVICE_ADDR                 {0xE8,0x3B,0xE3,0x88,0xB4,0xC8}</div>
<div class="line"> </div>
<div class="line">int application_start(int argc, char *argv[])</div>
<div class="line">{</div>
<div class="line">    int count = 0;</div>
<div class="line">    int ret;</div>
<div class="line">    dev_addr_t addr = {DEV_ADDR_LE_RANDOM, DEVICE_ADDR};</div>
<div class="line">    init_param_t init = {</div>
<div class="line">        .dev_name = EXAMPLE_BLE_DEV_NAME,</div>
<div class="line">        .dev_addr = &amp;addr,   //&amp;addr,</div>
<div class="line">        .conn_num_max = 1,</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    printf(&quot;nano entry here!\r\n&quot;);</div>
<div class="line"> </div>
<div class="line">#if 1</div>
<div class="line">    /* bt stack init */</div>
<div class="line">    ret = ble_stack_init(&amp;init);</div>
<div class="line">    if (ret) {</div>
<div class="line">        printf(&quot;error: ble_stack_init!, ret = %x\r\n&quot;, ret);</div>
<div class="line">        return -1;</div>
<div class="line">    }</div>
<div class="line">#endif</div>
<div class="line"> </div>
<div class="line">    while(1) {</div>
<div class="line">        printf(&quot;hello world! count %d \r\n&quot;, count++);</div>
<div class="line">        aos_msleep(1000);</div>
<div class="line">    };</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md134"></a>
编译烧录</h2>
<p>在solutions/helloworld_demo中执行aos make，编译成功后烧录进haas100开发板。<br  />
</p>
<h2><a class="anchor" id="autotoc_md135"></a>
运行观测</h2>
<p>打开串口工具，在串口工具中输入ble，可看到ble的cli命令集。<br  />
<img src="https://img.alicdn.com/imgextra/i1/O1CN01Vm24En1Hnoi4vJ9lC_!!6000000000803-2-tps-1932-922.png#align=left&amp;display=inline&amp;height=461&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=922&amp;originWidth=1932&amp;size=259937&amp;status=done&amp;style=none&amp;width=966#align=left&amp;display=inline&amp;height=293&amp;margin=%5Bobject%20Object%5D&amp;originHeight=922&amp;originWidth=1932&amp;status=done&amp;style=none&amp;width=614#align=left&amp;display=inline&amp;height=922&amp;margin=%5Bobject%20Object%5D&amp;originHeight=922&amp;originWidth=1932&amp;status=done&amp;style=none&amp;width=1932" alt="image.png" class="inline"/><br  />
</p>
<h2><a class="anchor" id="autotoc_md136"></a>
BLE广播与连接示例</h2>
<p>在串口工具中输入ble adv start 020106，可以在串口日志中看到如下打印 </p><div class="fragment"><div class="line">adv_type:0;adv_interval_min:160 (*0.625)ms;adv_interval_max:240 (*0.625)ms</div>
<div class="line">Advertising started</div>
</div><!-- fragment --><p><br  />
此时在手机端打开NRF Connect工具并搜索广播包，可以看到设备。<br  />
<img src="https://img.alicdn.com/imgextra/i2/O1CN01CZZkJl1ThCNOYmP1f_!!6000000002413-2-tps-700-1268.png#align=left&amp;display=inline&amp;height=520&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1268&amp;originWidth=700&amp;size=482965&amp;status=done&amp;style=none&amp;width=287#align=left&amp;display=inline&amp;height=828&amp;margin=%5Bobject%20Object%5D&amp;originHeight=1268&amp;originWidth=700&amp;status=done&amp;style=none&amp;width=457#align=left&amp;display=inline&amp;height=949&amp;margin=%5Bobject%20Object%5D&amp;originHeight=1268&amp;originWidth=700&amp;status=done&amp;style=none&amp;width=524" alt="image.png" class="inline"/><br  />
 <br  />
点击连接，可以看到Generic Access(GAP)和Generic Attribute(GATT)2个服务，点击GAP服务的Device Name的读取按键（下图红色圈中的箭头），可以读取到数值“HaaS BLE”<br  />
<img src="https://img.alicdn.com/imgextra/i3/O1CN01jK0smX1FJvdIip6ZO_!!6000000000467-2-tps-696-726.png#align=left&amp;display=inline&amp;height=363&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=726&amp;originWidth=696&amp;size=250340&amp;status=done&amp;style=none&amp;width=348#align=left&amp;display=inline&amp;height=469&amp;margin=%5Bobject%20Object%5D&amp;originHeight=726&amp;originWidth=696&amp;status=done&amp;style=none&amp;width=450#align=left&amp;display=inline&amp;height=548&amp;margin=%5Bobject%20Object%5D&amp;originHeight=726&amp;originWidth=696&amp;status=done&amp;style=none&amp;width=525" alt="image.png" class="inline"/><br  />
</p>
<h1><a class="anchor" id="autotoc_md137"></a>
常见问题</h1>
<div class="fragment"><div class="line">Q：此协议栈是否支持蓝牙音乐播放</div>
<div class="line">A：不支持经典蓝牙功能，仅支持BLE功能</div>
<div class="line"> </div>
<div class="line">Q：常见的GATT Service是否支持</div>
<div class="line">A：支持，包括BAS,DIS,HIDS等等，详情请参考ble_host/ble_profiles文件下的实现。</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
  </ul>
</div>
</body>
</html>
