<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<title>物联网操作系统AliOS Things 3.3: lwip</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygenextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="topbanner"><a href="https://github.com/Tencent/rapidjson" title="RapidJSON GitHub"><i class="githublogo"></i></a></div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.9.1 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('lwip.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">lwip </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md362"></a>
概述</h1>
<p>LwIP(Light Weight Internet Protoco1)是瑞士计算机科学院(Swedish Institute of Computer Science)AdamDunkels等人开发的一套用于嵌入式系统的开放源代码TCP／IP协议栈。LWIP的含义是Light Weight(轻型)IP协议。LWIP可以移植到操作系统上，也可以在无操作系统的情况下独立运行。LWIP TCP／IP实现的重点是在保持TCP协议主要功能的基础上减少对RAM的占用。一般它只需要几十KB的RAM和40 KB左右的ROM就可以运行，这使LWIP协议栈适合在小型嵌入式系统中使用。 官网：https://savannah.nongnu.org/projects/lwip/ 将LwIP协议栈分成四层： 1.应用层 2.传输层 3.网络层 4.网卡层 本文将2，3，4统称为协议层 应用层支持： arp, dhcpd, dns, httpd, ifconfig, iperf, lsfd, mdns, netbiosns, ping, sendfile, snmp, sntp, telnetd, tftp</p>
<p>协议层支持： IP (Internet Protocol, IPv4 and IPv6) including packet forwarding over multiple network interfaces ICMP (Internet Control Message Protocol) for network maintenance and debugging IGMP (Internet Group Management Protocol) for multicast traffic management MLD (Multicast listener discovery for IPv6). Aims to be compliant with RFC 2710. No support for MLDv2 ND (Neighbor discovery and stateless address autoconfiguration for IPv6). Aims to be compliant with RFC 4861 (Neighbor discovery) and RFC 4862 (Address autoconfiguration) UDP (User Datagram Protocol) including experimental UDP-lite extensions TCP (Transmission Control Protocol) with congestion control, RTT estimation and fast recovery/fast retransmit raw/native API for enhanced performance Optional Berkeley-like socket API DNS (Domain names resolver)</p>
<h2><a class="anchor" id="autotoc_md363"></a>
版权信息</h2>
<blockquote class="doxtable">
<p>Apache license v2.0 </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md364"></a>
目录结构</h2>
<div class="fragment"><div class="line">├── api</div>
<div class="line">│   ├── api_lib.c  # 库</div>
<div class="line">│   ├── api_msg.c  # 消息机制</div>
<div class="line">│   ├── err.c      # 异常api</div>
<div class="line">│   ├── netbuf.c   # 网络缓存api</div>
<div class="line">│   ├── netdb.c    # dns实现</div>
<div class="line">│   ├── netifapi.c # 网卡api</div>
<div class="line">│   ├── sockets.c  # 套接字api</div>
<div class="line">│   └── tcpip.c    # tcpip任务实现</div>
<div class="line">├── apps           # LwIP 应用</div>
<div class="line">│   ├── arp        # arp应用</div>
<div class="line">│   ├── dhcpd      # dhcpd应用</div>
<div class="line">│   ├── dns        # dns应用</div>
<div class="line">│   ├── httpd      # httpd应用</div>
<div class="line">│   ├── ifconfig   # ifconfig应用</div>
<div class="line">│   ├── iperf      # iperf应用</div>
<div class="line">│   ├── lsfd       # lsfd应用</div>
<div class="line">│   ├── mdns       # mdns应用</div>
<div class="line">│   ├── netbiosns  # netbiosns应用</div>
<div class="line">│   ├── ping       # ping应用</div>
<div class="line">│   ├── sendfile   # sendfile应用</div>
<div class="line">│   ├── snmp       # snmp应用</div>
<div class="line">│   ├── sntp       # sntp应用</div>
<div class="line">│   ├── telnetd    # telnetd应用</div>
<div class="line">│   └── tftp       # tftp应用</div>
<div class="line">├── core           # LwIP协议栈核心模块，IPv4/IPv6/TCP/UDP等协议实现</div>
<div class="line">├── include        # 头文件</div>
<div class="line">├── netif          # 网卡锡相关</div>
<div class="line">└── port           # 移植对接</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md365"></a>
依赖组件</h2>
<h1><a class="anchor" id="autotoc_md366"></a>
常用配置</h1>
<p>系统中相关配置已有默认值，如需修改配置，统一在yaml中**def_config**节点修改，具体如下： </p><blockquote class="doxtable">
<p>使能TCPIP是1，不使能TCPIP是0，默认是1，可修改yaml配置如 </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CONFIG_TCPIP: 1  </div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>使用AOS的LwIP是1， 不实用AOS的LwIP是0，默认是1，可修改yaml配置如： </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CONFIG_AOS_LWIP: 1</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>使能LwIP数据包打印功能是1， 不使能是0，默认1，可修改yaml配置如： </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  WITH_LWIP_PKTPRINT: 1</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md367"></a>
API说明</h1>
<h2><a class="anchor" id="autotoc_md368"></a>
创建socket</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> socket(<span class="keywordtype">int</span> domain, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> protocol);</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">domain   </td><td class="markdownTableBodyLeft">协议域    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">type   </td><td class="markdownTableBodyLeft">类型    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">protocol   </td><td class="markdownTableBodyLeft">传输协议   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md369"></a>
绑定地址端口</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> bind(<span class="keywordtype">int</span> s, <span class="keyword">const</span> <span class="keyword">struct</span> sockaddr *addr, socklen_t namelen)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s   </td><td class="markdownTableBodyLeft">要绑定的 socket描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">addr   </td><td class="markdownTableBodyLeft">一个指向含有本机 IP 地址和端口号等信息的 sockaddr 结构的指针    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">namelen   </td><td class="markdownTableBodyLeft">sockaddr 结构的长度   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md370"></a>
将套接字设为监听模式，并在套接字指定的端口上开始监听，以便对到达的服务请求进行处理</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> listen(<span class="keywordtype">int</span> s, <span class="keywordtype">int</span> backlog)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s   </td><td class="markdownTableBodyLeft">要绑定的 socket描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">backlog   </td><td class="markdownTableBodyLeft">连接请求队列可以容纳的最大数目   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md371"></a>
从完全建立的连接的队列中接受一个连接</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> accept(<span class="keywordtype">int</span> s, <span class="keyword">struct</span> sockaddr *addr, socklen_t *addrlen)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s   </td><td class="markdownTableBodyLeft">socket描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">backlog   </td><td class="markdownTableBodyLeft">连接请求队列可以容纳的最大数目   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md372"></a>
与服务器建立一个 TCP 连接</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> connect(<span class="keywordtype">int</span> s, <span class="keyword">const</span> <span class="keyword">struct</span> sockaddr *name, socklen_t namelen)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s   </td><td class="markdownTableBodyLeft">socket描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">name   </td><td class="markdownTableBodyLeft">指向 sockaddr 结构的指针，存放要连接的服务器的 IP 地址和端口号等信息    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">namelen   </td><td class="markdownTableBodyLeft">sockaddr 结构体的长度   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md373"></a>
面向连接的数据流 socket 模式下发送数据</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> send(<span class="keywordtype">int</span> s, <span class="keyword">const</span> <span class="keywordtype">void</span> *dataptr, <span class="keywordtype">size_t</span> size, <span class="keywordtype">int</span> flags)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s   </td><td class="markdownTableBodyLeft">socket描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">dataptr   </td><td class="markdownTableBodyLeft">指向所要发送的数据区的指针    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">size   </td><td class="markdownTableBodyLeft">要发送的字节数    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">flags   </td><td class="markdownTableBodyLeft">控制选项，通常为 0   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md374"></a>
面向连接的数据流 socket 模式下接收数据</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> send(<span class="keywordtype">int</span> s, <span class="keyword">const</span> <span class="keywordtype">void</span> *dataptr, <span class="keywordtype">size_t</span> size, <span class="keywordtype">int</span> flags)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s   </td><td class="markdownTableBodyLeft">socket描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">mem   </td><td class="markdownTableBodyLeft">指向存储数据的内存缓存区的指针    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">len   </td><td class="markdownTableBodyLeft">缓冲区的长度    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">flags   </td><td class="markdownTableBodyLeft">控制选项，通常为 0   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md375"></a>
在无连接的数据报 socket 模式下发送数据</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> sendto(<span class="keywordtype">int</span> s, <span class="keyword">const</span> <span class="keywordtype">void</span> *dataptr, <span class="keywordtype">size_t</span> size, <span class="keywordtype">int</span> flags, <span class="keyword">const</span> <span class="keyword">struct</span> sockaddr *to, socklen_t tolen)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s   </td><td class="markdownTableBodyLeft">socket描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">size   </td><td class="markdownTableBodyLeft">要发送的字节数    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">flags   </td><td class="markdownTableBodyLeft">控制选项，通常为 0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">to   </td><td class="markdownTableBodyLeft">指向 sockaddr 结构体的指针，存放目的主机的 IP 和端口号    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">tolen   </td><td class="markdownTableBodyLeft">sockaddr 结构体的长度   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md376"></a>
在无连接的数据报 socket 模式下接收数据</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> recvfrom(<span class="keywordtype">int</span> s, <span class="keywordtype">void</span>*mem, <span class="keywordtype">size_t</span> size, <span class="keywordtype">int</span> flags, <span class="keyword">struct</span> sockaddr *from, socklen_t *fromlen)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s   </td><td class="markdownTableBodyLeft">socket描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">mem   </td><td class="markdownTableBodyLeft">指向存储数据的内存缓存区的指针    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">size   </td><td class="markdownTableBodyLeft">缓冲区的长度    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">flags   </td><td class="markdownTableBodyLeft">控制选项，通常为 0    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">from   </td><td class="markdownTableBodyLeft">指向 sockaddr 结构体的指针，存放源主机的 IP 和端口号    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">fromlen   </td><td class="markdownTableBodyLeft">指向 sockaddr 结构体的长度的指针   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md377"></a>
查询一个或者多个socket的可读性、可写性及错误状态信息</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> select(<span class="keywordtype">int</span> maxfdp1, fd_set *readset, fd_set *writeset, fd_set *exceptset,</div>
<div class="line">                <span class="keyword">struct</span> timeval *timeout)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">maxfdp1   </td><td class="markdownTableBodyLeft">最大的文件描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">readset   </td><td class="markdownTableBodyLeft">读文件描述符    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">writeset   </td><td class="markdownTableBodyLeft">写文件描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">exceptset   </td><td class="markdownTableBodyLeft">异常的文件描述符    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">timeout   </td><td class="markdownTableBodyLeft">超时时间   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md378"></a>
传输完数据之后关闭 socket 并释放资源</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> closesocket(<span class="keywordtype">int</span> s)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s   </td><td class="markdownTableBodyLeft">socket 描述符   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md379"></a>
允许进行单向的关闭操作，或是全部禁止掉</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> shutdown(<span class="keywordtype">int</span> s, <span class="keywordtype">int</span> how)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s   </td><td class="markdownTableBodyLeft">socket 描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">how   </td><td class="markdownTableBodyLeft">控制选项   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md380"></a>
通过域名来获取主机的 IP 地址等信息</h2>
<div class="fragment"><div class="line"><span class="keyword">struct </span>hostent* gethostbyname(<span class="keyword">const</span> <span class="keywordtype">char</span>*name)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">name   </td><td class="markdownTableBodyLeft">主机域名   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md381"></a>
获取本地主机的信息</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> getsockname(<span class="keywordtype">int</span> s, <span class="keyword">struct</span> sockaddr *name, socklen_t *namelen)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s   </td><td class="markdownTableBodyLeft">socket 描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">name   </td><td class="markdownTableBodyLeft">sockaddr 结构体指针，用来存储得到的主机信息    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">namelen   </td><td class="markdownTableBodyLeft">指向 sockaddr 结构体的长度的指针   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md382"></a>
得到与本地主机连接的远程主机的信息</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> getpeername(<span class="keywordtype">int</span> s, <span class="keyword">struct</span> sockaddr *name, socklen_t *namelen)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s   </td><td class="markdownTableBodyLeft">socket 描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">name   </td><td class="markdownTableBodyLeft">sockaddr 结构体指针，用来存储得到的主机信息    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">namelen   </td><td class="markdownTableBodyLeft">指向 sockaddr 结构体的长度的指针   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md383"></a>
设置套接字控制模式</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ioctlsocket(<span class="keywordtype">int</span> s, <span class="keywordtype">long</span> cmd, <span class="keywordtype">void</span> *argp)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s   </td><td class="markdownTableBodyLeft">socket 描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">cmd   </td><td class="markdownTableBodyLeft">套接字操作命令    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">argp   </td><td class="markdownTableBodyLeft">操作命令所带参数   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md384"></a>
获取套接字控制模式</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> getsockopt (<span class="keywordtype">int</span> s, <span class="keywordtype">int</span> level, <span class="keywordtype">int</span> optname, <span class="keywordtype">void</span> *optval, socklen_t *optlen)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s   </td><td class="markdownTableBodyLeft">socket 描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">level   </td><td class="markdownTableBodyLeft">选项定义的层次；目前支持SOL_SOCKET, SOL_PACKET, IPPROTO_IP和IPPROTO_TCP    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">optname   </td><td class="markdownTableBodyLeft">需设置的选项    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">optval   </td><td class="markdownTableBodyLeft">指向option属性的指针    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">optlen   </td><td class="markdownTableBodyLeft">指向option属性长度的指针   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md385"></a>
设置套接字控制模式</h2>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> setsockopt (<span class="keywordtype">int</span> s, <span class="keywordtype">int</span> level, <span class="keywordtype">int</span> optname, <span class="keyword">const</span> <span class="keywordtype">void</span> *optval, socklen_t optlen)</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">args   </th><th class="markdownTableHeadLeft">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">s   </td><td class="markdownTableBodyLeft">socket 描述符    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">level   </td><td class="markdownTableBodyLeft">选项定义的层次；目前支持SOL_SOCKET, SOL_PACKET, IPPROTO_IP和IPPROTO_TCP    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">optname   </td><td class="markdownTableBodyLeft">需设置的选项    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">optval   </td><td class="markdownTableBodyLeft">指向option属性的指针    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">optlen   </td><td class="markdownTableBodyLeft">option属性的长度   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md386"></a>
使用示例</h1>
<p>示例代码参考example/udp_test.c，以运行solution/helloworld_demo为例，具体步骤如下：</p>
<h2><a class="anchor" id="autotoc_md387"></a>
添加示例代码</h2>
<blockquote class="doxtable">
<p>lwip组件的package.yaml中添加example </p>
</blockquote>
<div class="fragment"><div class="line">source_file:</div>
<div class="line">  - example/*.c</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md388"></a>
添加kv组件</h2>
<blockquote class="doxtable">
<p>helloworld_demo组件的package.yaml中添加 </p>
</blockquote>
<div class="fragment"><div class="line">depends:</div>
<div class="line">  - netmgr     # 添加netmgr依赖，使用netmgr连接wifi</div>
<div class="line">  - lwip       # helloworld_demo中引入lwip组件</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md389"></a>
编译</h2>
<div class="fragment"><div class="line">cd solutions/helloworld_demo &amp;&amp; aos make</div>
</div><!-- fragment --><p> 其中具体单板还需要先配置环境： </p><div class="fragment"><div class="line">aos make helloworld_demo@haas100 -c config</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md390"></a>
烧录固件</h2>
<blockquote class="doxtable">
<p>参考具体板子的快速开始文档。 </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md391"></a>
lwip 示例测试</h2>
<blockquote class="doxtable">
<p>CLI命令行输入netmgr相关命令进行联网操作： </p>
</blockquote>
<div class="fragment"><div class="line">netmgr_example                           # 启动netmgr组件</div>
<div class="line">netmgr -t wifi -c wifissid wifipassword  # 输入ssid和密码</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>CLI命令行输入udp 测试命令： </p>
</blockquote>
<div class="fragment"><div class="line">test_udp</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md392"></a>
关键日志</h2>
<blockquote class="doxtable">
<p>输入联网命令后的WIFI联网成功日志： </p>
</blockquote>
<div class="fragment"><div class="line">Got IP</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>启动test_udp之后的数据接收打印： </p>
</blockquote>
<div class="fragment"><div class="line">test_udp</div>
<div class="line"> </div>
<div class="line">(cli-uart)# hello world! count 15</div>
<div class="line">recv: hello UDP</div>
<div class="line">hello world! count 16</div>
<div class="line">recv: hello UDP</div>
<div class="line">hello world! count 17</div>
<div class="line">recv: hello UDP</div>
<div class="line">hello world! count 18</div>
<div class="line">recv: hello UDP</div>
<div class="line">hello world! count 19</div>
<div class="line">recv: hello UDP</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md393"></a>
注意事项</h1>
<ul>
<li>使用lwip前，请先确定已经联网</li>
</ul>
<h1><a class="anchor" id="autotoc_md394"></a>
FAQ</h1>
<p>NA </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
  </ul>
</div>
</body>
</html>
