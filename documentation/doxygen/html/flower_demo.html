<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<title>物联网操作系统AliOS Things 3.3: flower_demo</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygenextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="topbanner"><a href="https://github.com/Tencent/rapidjson" title="RapidJSON GitHub"><i class="githublogo"></i></a></div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.9.1 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('flower_demo.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">flower_demo </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md897"></a>
1. 案例简介</h1>
<p>过去，很多人一听嵌入式～～智能硬件～～就有点头大，甚至会感到一丝丝的恐惧。 其实不然，HaaS积木真的就能让智能硬件简单～好玩～普惠。 接下来，就以HaaS打造的花卉养植盒子系统为例，指引开发者如何自己一步步简单快速搭建起属于自己的好玩智能硬件。 <img src="https://intranetproxy.alipay.com/skylark/lark/0/2021/gif/106133/1616385299899-68c544e2-d6a6-4aeb-b0e5-926df78ced9f.gif#align=left&amp;display=inline&amp;height=330&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%87.gif&amp;originHeight=1080&amp;originWidth=1440&amp;size=1255665&amp;status=done&amp;style=none&amp;width=440" alt="图片.gif" class="inline"/> </p>
<h1><a class="anchor" id="autotoc_md898"></a>
2. 基础知识</h1>
<p>本案例主要依赖的硬件环境有：HaaS100、温湿度传感器。 </p>
<h2><a class="anchor" id="autotoc_md899"></a>
2.1  &lt;strong&gt;HaaS100开发板&lt;/strong&gt;</h2>
<p><b>HaaS100**是一款物联网场景中的标准开发板，并配套嵌入到硬件中的软件驱动及功能模块，为用户提供物联网设备高效开发服务。 <img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/113837/1607656919362-55ec2c19-a0dd-4d1d-ac95-2052ffeedd7f.png#align=left&amp;display=inline&amp;height=295&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=443&amp;originWidth=443&amp;size=130743&amp;status=done&amp;style=none&amp;width=295" alt="image.png" class="inline"/> HaaS100核心板有着丰富的外设接口，如下所示： **<img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/106133/1607655121564-f799e873-94f0-485d-8d1c-95ba5cafaf5f.png#align=left&amp;display=inline&amp;height=352&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=886&amp;originWidth=586&amp;size=232115&amp;status=done&amp;style=none&amp;width=233" alt="image.png" class="inline"/></b> 详细的资料参考<a href="https://help.aliyun.com/document_detail/184186.html?spm=a2c4g.11186623.6.645.718015814zDYZt">HaaS 100 硬件规格</a>。 </p>
<h2><a class="anchor" id="autotoc_md900"></a>
2.2  温湿度传感器</h2>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/106133/1602668227884-a0540759-321e-42c9-9aec-90c2267c378c.png#align=left&amp;display=inline&amp;height=176&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=872&amp;originWidth=1604&amp;size=1688048&amp;status=done&amp;style=none&amp;width=324" alt="image.png" class="inline"/> DHT11温湿度传感器的工作原理 </p>
<h3><a class="anchor" id="autotoc_md901"></a>
2.2.1 工作时序</h3>
<p>主机发开始信号-》DHT11响应输出-》DHT11数据信号。（平时默认为高电平，起始信号为低电平） <img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/106133/1602666711277-0c4ce043-f504-4d27-9f57-b6520c1922ce.png#align=left&amp;display=inline&amp;height=145&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=352&amp;originWidth=1398&amp;size=408102&amp;status=done&amp;style=none&amp;width=574" alt="image.png" class="inline"/> </p>
<h3><a class="anchor" id="autotoc_md902"></a>
2.2.2 起始信号和响应信号的规则</h3>
<p>主机发开始信号：低电平大于18ms，高电平20-40us； DHT11的响应信号：低电平80us，高电平80us； <img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/106133/1602667431782-a4549dcb-a5fc-469f-9618-12a3913ae2d9.png#align=left&amp;display=inline&amp;height=180&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=508&amp;originWidth=1592&amp;size=583957&amp;status=done&amp;style=none&amp;width=565" alt="image.png" class="inline"/> </p>
<h3><a class="anchor" id="autotoc_md903"></a>
2.2.3数字信号的规则</h3>
<div class="fragment"><div class="line">一次完整的数据传输为40bit,高位先出。</div>
<div class="line">数据格式:8bit湿度整数数据+8bit湿度小数数据+8bit温度整数数据+8bit温度小数数据+8bit校验和</div>
<div class="line">校验和数据=“8bit湿度整数数据+8bit湿度小数数据+8bi温度整数数据+8bit温度小数数据”所得结果的末8位。</div>
</div><!-- fragment --><p> DHT11传感器如果没有接收到主机发送开始信号,不会主动进行温湿度采集。 数字‘0’信号：低电平50us，高电平26-28us <img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/106133/1602667907635-819f1ad4-ed9e-489b-9a1d-973cff036156.png#align=left&amp;display=inline&amp;height=194&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=850&amp;originWidth=1564&amp;size=985414&amp;status=done&amp;style=none&amp;width=357" alt="image.png" class="inline"/> 数字‘1’信号：低电平50us，高电平70us <img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/106133/1602668007947-084bf9ad-ff1c-45da-b111-7e045fb15e03.png#align=left&amp;display=inline&amp;height=166&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=730&amp;originWidth=1574&amp;size=760932&amp;status=done&amp;style=none&amp;width=357" alt="image.png" class="inline"/> </p>
<h1><a class="anchor" id="autotoc_md904"></a>
3 物料清单</h1>
<p>| <b>物料</b> | <b>规格</b> | <b>购买链接</b> | | :&mdash;: | :&mdash;: | :&mdash;: | | HaaS100开发板 | | 阿里云<a href="https://detail.tmall.com/item.htm?spm=a230r.1.14.16.13123b209835rz&amp;id=627354125244&amp;ns=1&amp;abbucket=16">天猫链接</a> | | DHT11温湿度传感器 | 用来采集器空气中的温度和湿度，为单总线数据交互模式 | &#160;Risym <a href="https://detail.tmall.com/item.htm?id=15598344236&amp;ali_refid=a3_430582_1006:1104520036:N:TAiHo9GD8eTurMzH21/csQ==:fc360fe0aaa2a823247db3c6a3bd21fc&amp;ali_trackid=1_fc360fe0aaa2a823247db3c6a3bd21fc&amp;spm=a230r.1.14.1">天猫链接</a> TELESKY <a href="https://detail.tmall.com/item.htm?id=41248630584&amp;ali_refid=a3_430582_1006:1109983619:N:77RKeLgkEXuYPsQPL/pGPA==:31c58e63c712d4a9ee33af685ecb1c61&amp;ali_trackid=1_31c58e63c712d4a9ee33af685ecb1c61&amp;spm=a230r.1.14.6">天猫链接</a> 优信电子 <a href="https://item.taobao.com/item.htm?spm=a230r.1.14.15.77176c121VUnMs&amp;id=522553143872&amp;ns=1&amp;abbucket=12#detail">淘宝链接</a> |</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2021/png/106133/1616384880211-5d026ce6-2540-47ea-8a49-c0420a3dd2a9.png#align=left&amp;display=inline&amp;height=585&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=4032&amp;originWidth=3024&amp;size=11665408&amp;status=done&amp;style=none&amp;width=439" alt="image.png" class="inline"/> </p>
<h1><a class="anchor" id="autotoc_md905"></a>
4. 案例实现</h1>
<h2><a class="anchor" id="autotoc_md906"></a>
4.1 硬件连接</h2>
<p>HaaS100与温湿度传感器和土壤湿度传感器的接口说明。</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter"><b>HaaS100接口</b>   </th><th class="markdownTableHeadCenter"><b>传感器接口</b>   </th><th class="markdownTableHeadCenter"><b>说明</b>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">GPIO01   </td><td class="markdownTableBodyCenter">OUT   </td><td class="markdownTableBodyCenter">DHT11温湿度传感器    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">GND   </td><td class="markdownTableBodyCenter">GND   </td><td class="markdownTableBodyCenter">电源地    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">VCC   </td><td class="markdownTableBodyCenter">3V3   </td><td class="markdownTableBodyCenter">3V3电源   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md907"></a>
4.2 软件设计</h2>
<h3><a class="anchor" id="autotoc_md908"></a>
4.2.1 云端创建产品</h3>
<p>请先点击登陆<a href="https://www.aliyun.com/product/iot/iot_instc_public_cn">物联网平台</a>（未注册阿里云账户的用户，请先完成账户注册），按下面步骤一步步去打造 1、创建项目 注册登入后，如下图所示，前往管理控制台。 <img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/106133/1606826963138-9cca56da-824c-4ae5-9a32-ad027e7ca4b3.png#align=left&amp;display=inline&amp;height=170&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=490&amp;originWidth=1308&amp;size=276942&amp;status=done&amp;style=none&amp;width=453" alt="image.png" class="inline"/> 点击公共实例，进行产品创建 <img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/106133/1606827081165-bc920f5f-01d3-425f-9662-5066d8f2e956.png#align=left&amp;display=inline&amp;height=302&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=792&amp;originWidth=1328&amp;size=142752&amp;status=done&amp;style=none&amp;width=506" alt="image.png" class="inline"/> 2、创建HaaS养花的产品 点击创建产品，见下图所示，这里创建了一个名称“HaaS养花”产品。 <img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/106133/1606827234913-22f3e20f-b7d0-4f5e-9983-7c72c969f1b8.png#align=left&amp;display=inline&amp;height=239&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=600&amp;originWidth=1490&amp;size=211557&amp;status=done&amp;style=none&amp;width=594" alt="image.png" class="inline"/> 在产品详情中增加产品的功能，比如：温度、湿度等。 <img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/106133/1606827812867-70ddac4b-b9a1-4f00-9f4f-7b5f7d355b2d.png#align=left&amp;display=inline&amp;height=207&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=900&amp;originWidth=2538&amp;size=426175&amp;status=done&amp;style=none&amp;width=584" alt="image.png" class="inline"/> 3、设备管理 在设备列表中增加对应产品的设备。 <img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/106133/1606827539100-7af21569-9224-4ad7-aca5-480d84ff50d1.png#align=left&amp;display=inline&amp;height=247&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=874&amp;originWidth=1910&amp;size=364503&amp;status=done&amp;style=none&amp;width=540" alt="image.png" class="inline"/> 查看设备信息 <img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/106133/1606828516473-c35480c2-143e-47a0-a0a1-3ac979b6a4c4.png#align=left&amp;display=inline&amp;height=214&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=994&amp;originWidth=2734&amp;size=486092&amp;status=done&amp;style=none&amp;width=588" alt="image.png" class="inline"/> 创建后的设备三元组信息需要同步到设备端的开发代码段中，在3.1章节会介绍。待设备端开发结束，就可以在物联网平台中参看设备在线状态。 </p>
<h3><a class="anchor" id="autotoc_md909"></a>
4.2.2 设备端代码</h3>
<p>传感器GPIO初始化接口，参考文档路径：solutions/flower_demo/flower_app.c </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> flower_gpio_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    gpio_dev_t temp_gpio;</div>
<div class="line"> </div>
<div class="line">    temp_gpio.port = HAL_IOMUX_PIN_P0_1;</div>
<div class="line">    temp_gpio.config = OUTPUT_OPEN_DRAIN_PULL_UP;</div>
<div class="line">    hal_gpio_init(&amp;temp_gpio);</div>
<div class="line"> </div>
<div class="line">    fd = open(<span class="stringliteral">&quot;/dev/gpio&quot;</span>, 0);</div>
<div class="line">    printf(<span class="stringliteral">&quot;open gpio %s, fd:%d\r\n&quot;</span>, fd &gt;= 0 ? <span class="stringliteral">&quot;success&quot;</span> : <span class="stringliteral">&quot;fail&quot;</span>, fd);</div>
<div class="line"> </div>
<div class="line">    DHT11_GPIO_Set(1);</div>
<div class="line">    DHT11_Reset();</div>
<div class="line">    <a class="code" href="group__cli__aos__api.html#ga0bedf67ee7ec64305141156e82619704">aos_cli_register_command</a>(&amp;temp_cmd);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__cli__aos__api_html_ga0bedf67ee7ec64305141156e82619704"><div class="ttname"><a href="group__cli__aos__api.html#ga0bedf67ee7ec64305141156e82619704">aos_cli_register_command</a></div><div class="ttdeci">int aos_cli_register_command(const struct cli_command *cmd)</div><div class="ttdoc">This function register a command with the command-line interface</div></div>
</div><!-- fragment --><p> 与物联网平台连接需要使用三元组信息以及温湿度上报，参考文档路径：solutions/flower_demo/data_model_basic_demo.c </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> demo_main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    int32_t     res = STATE_SUCCESS;</div>
<div class="line">    <span class="keywordtype">void</span>       *dm_handle = NULL;</div>
<div class="line">    <span class="keywordtype">void</span>       *mqtt_handle = NULL;</div>
<div class="line">    <span class="keywordtype">char</span>       *url = <span class="stringliteral">&quot;iot-as-mqtt.cn-shanghai.aliyuncs.com&quot;</span>; <span class="comment">/* 阿里云平台上海站点的域名后缀 */</span></div>
<div class="line">    <span class="keywordtype">char</span>        host[100] = {0}; <span class="comment">/* 用这个数组拼接设备连接的云平台站点全地址, 规则是 ${productKey}.iot-as-mqtt.cn-shanghai.aliyuncs.com */</span></div>
<div class="line">    uint16_t    port = 443;      <span class="comment">/* 无论设备是否使用TLS连接阿里云平台, 目的端口都是443 */</span></div>
<div class="line">    aiot_sysdep_network_cred_t cred; <span class="comment">/* 安全凭据结构体, 如果要用TLS, 这个结构体中配置CA证书等参数 */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* TODO: 替换为自己设备的三元组 */</span></div>
<div class="line">    <span class="keywordtype">char</span> *product_key       = <span class="stringliteral">&quot;产品key&quot;</span>;</div>
<div class="line">    <span class="keywordtype">char</span> *device_name       = <span class="stringliteral">&quot;设备名&quot;</span>;</div>
<div class="line">    <span class="keywordtype">char</span> *device_secret     = <span class="stringliteral">&quot;设备密钥&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    ...</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* 主循环进入休眠 */</span></div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">        report_2_cloud(dm_handle); <span class="comment">//每隔3s检测是否有温湿度变化检测</span></div>
<div class="line">        <a class="code" href="group__aos__kernel__time.html#ga198267174bf34247bca2163293c20d5c">aos_msleep</a>(3000);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__aos__kernel__time_html_ga198267174bf34247bca2163293c20d5c"><div class="ttname"><a href="group__aos__kernel__time.html#ga198267174bf34247bca2163293c20d5c">aos_msleep</a></div><div class="ttdeci">void aos_msleep(uint32_t ms)</div></div>
</div><!-- fragment --><p> 温湿度检测上报report_2_cloud()，参考文档路径：solutions/flower_demo/flower_app.c </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> report_2_cloud(<span class="keywordtype">void</span> *dm_handle)</div>
<div class="line">{</div>
<div class="line">    uint8_t temp =0,humidity=0,d_flag = 0;</div>
<div class="line">    <span class="keywordtype">char</span> property_payload[30] = {0};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(mqtt_status == 0){</div>
<div class="line">        printf(<span class="stringliteral">&quot;mqtt status :%d %p\r\n&quot;</span>,mqtt_status,dm_handle);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    d_flag = DHT11_Read_Data(&amp;temp,&amp;humidity);</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;temp -&gt;%d  humidity-&gt;%d --%d\n&quot;</span>,temp,humidity,d_flag);</div>
<div class="line">    <span class="keywordflow">if</span>((last_temp != temp)&amp;&amp;(!d_flag)){</div>
<div class="line">        <span class="comment">//温度变化上报接口</span></div>
<div class="line">        snprintf(property_payload, <span class="keyword">sizeof</span>(property_payload), <span class="stringliteral">&quot;{\&quot;Temperature\&quot;: %d}&quot;</span>, temp);</div>
<div class="line">        printf(<span class="stringliteral">&quot;report:%s\r\n&quot;</span>,property_payload);</div>
<div class="line">        demo_send_property_post(dm_handle, property_payload);</div>
<div class="line">        last_temp = temp;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span>((last_hum != humidity)&amp;&amp;(!d_flag)){</div>
<div class="line">        <span class="comment">//湿度变化上报接口</span></div>
<div class="line">        snprintf(property_payload, <span class="keyword">sizeof</span>(property_payload), <span class="stringliteral">&quot;{\&quot;Humidity\&quot;: %d}&quot;</span>, humidity);</div>
<div class="line">        printf(<span class="stringliteral">&quot;report:%s\r\n&quot;</span>,property_payload);</div>
<div class="line">        demo_send_property_post(dm_handle, property_payload);</div>
<div class="line">        last_hum = humidity;</div>
<div class="line">    } </div>
<div class="line">}</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md910"></a>
4.2.3 小程序开发1、 云端钉一体小程序SDK获取</h3>
<div class="fragment"><div class="line">git clone -b dev_3.1.0_haas https://github.com/alibaba/AliOS-Things.git</div>
</div><!-- fragment --><p> SDK相关代码及操作readme在application/miniapp/目录下。 2、 SDK目录结构 / ├─ lib (存放依赖库的文件夹，用户无需关心) │ &#160; &#160;├─ @alicloud/pop-core &#160; &#160; （<a href="https://github.com/aliyun/openapi-core-nodejs-sdk">https://github.com/aliyun/openapi-core-nodejs-sdk</a>） │ &#160; &#160;├─ kitx │ &#160; &#160;└─ iot-packet.js &#160; &#160; &#160; &#160; &#160; &#160; &#160;（封装给用户的文件） ├─ pages &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;（页面文件夹，用户在这里自定义页面，示例持续更新中） │ &#160; &#160;└─ index &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;（首页 选择进入不同示例） │ &#160; &#160; &#160; &#160; &#160; &#160; ├─ index.axml &#160; &#160; &#160; &#160; │ &#160; &#160; &#160; &#160; &#160; &#160; ├─ index.js &#160; &#160; &#160; &#160; &#160; │ &#160; &#160; &#160; &#160; &#160; &#160; ├─ index.acss │ &#160; &#160; &#160; &#160; &#160; &#160; └─ index.json │ &#160; &#160;└─ HaasFlower &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;（示例1 HaaS养花） │ &#160; &#160; &#160; &#160; &#160; &#160; ├─ HaasFlower.axml &#160; &#160;（页面布局文件） │ &#160; &#160; &#160; &#160; &#160; &#160; ├─ HaasFlower.js &#160; &#160; &#160; &#160;（控制逻辑，用户在这里定义交互行为） │ &#160; &#160; &#160; &#160; &#160; &#160; ├─ HaasFlower.acss &#160; &#160;（页面样式） │ &#160; &#160; &#160; &#160; &#160; &#160; ├─ HaasFlower.json &#160; &#160; &#160;（页面配置，用于配置页面标题等） │ &#160; &#160; &#160; &#160; &#160; &#160; └─ HaasFlower.TSL.json（示例对应的TSL文件，可以在物联网平台上导入该文件生成物模型） │ &#160; &#160;└─ HaasCar &#160; &#160; &#160; &#160; &#160; &#160; &#160;（示例2 HaaS小小蛮驴，目录结构同 HaasFlower） ├─ app.js &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;（注册小程序，在这里进行全局参数配置，如 AccessKey） ├─ app.acss &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; （小程序全局样式） ├─ app.json &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; （小程序全局配置，可以在这里设置小程序打开的默认页面） └─ others</p>
<p>3、 SDK使用 使用小程序开发工具打开miniapp这个工程。 <img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/113837/1607309104502-3aa9a406-93a3-4b6e-84e4-4d2fa8a13894.png#align=left&amp;display=inline&amp;height=618&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1236&amp;originWidth=2144&amp;size=1065527&amp;status=done&amp;style=none&amp;width=1072" alt="image.png" class="inline"/></p>
<ul>
<li>step1 在app.js填写 AccessKeyID 以及 AccessKeySecret ， 获取云端API调用权限</li>
<li>step2 填写目标设备 DeviceName 以及 ProductKey，这里是待控制的设备</li>
</ul>
<div class="fragment"><div class="line">// app.js</div>
<div class="line">let accessKey = {</div>
<div class="line">  accessKeyId: &#39;&lt;- accessKeyId -&gt;&#39;,     // 填入阿里云平台生成的 assessKeyId 以及 Secret</div>
<div class="line">  accessKeySecret: &#39;&lt;- accessKeySecret -&gt;&#39;,</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// HaasFlower.js</div>
<div class="line">let device = {</div>
<div class="line">  DeviceName: &#39;&lt;- DeviceName -&gt;&#39;,   // 填入目标设备 DeviceName 以及 ProductKey</div>
<div class="line">  ProductKey: &#39;&lt;- ProductKey -&gt;&#39;</div>
<div class="line">}</div>
</div><!-- fragment --><p>代码中提到的几个关键参数：</p>
<ul>
<li>AccessKeyID AccessKeySecret</li>
</ul>
<p>云账号AccessKey是用户访问阿里云API的密钥。（<a href="https://usercenter.console.aliyun.com/#/manage/ak">https://usercenter.console.aliyun.com/#/manage/ak</a>） 安全起见，我们可以采取创建<a href="https://ram.console.aliyun.com/users">RAM子账号</a>的形式，来对权限进行分离。 <img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/256836/1603947703740-e6e2b231-57af-4968-94ed-377b10f65ff3.png#align=left&amp;display=inline&amp;height=732&amp;margin=%5Bobject%20Object%5D&amp;name=%E6%88%AA%E5%B1%8F2020-10-29%20%E4%B8%8B%E5%8D%881.01.39.png&amp;originHeight=732&amp;originWidth=3584&amp;size=210321&amp;status=done&amp;style=none&amp;width=3584" alt="截屏2020-10-29 下午1.01.39.png" class="inline"/> 创建完成后，需要手动分配权限，点击右侧，添加权限。我这里直接选择了 **AdministratorAccess。 **添加完成后如下。 <img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/256836/1603947799141-4f21e9a1-ca11-46bb-be60-95075cadb597.png#align=left&amp;display=inline&amp;height=1920&amp;margin=%5Bobject%20Object%5D&amp;name=%E6%88%AA%E5%B1%8F2020-10-29%20%E4%B8%8B%E5%8D%881.03.13.png&amp;originHeight=1920&amp;originWidth=3584&amp;size=578859&amp;status=done&amp;style=none&amp;width=3584" alt="截屏2020-10-29 下午1.03.13.png" class="inline"/></p>
<ul>
<li>DeviceName ProducKey</li>
</ul>
<p>这两个参数在<a href="#jSkOe">创建设备</a>时生成。 4、 编译验证 点击小程序IDE右上角“真机调试”按钮，等待二维码生成后，使用钉钉APP扫码，即可发起小程序。 <img src="https://intranetproxy.alipay.com/skylark/lark/0/2020/png/256836/1605585495799-64ecf7b0-ae07-44db-8d2a-d2219316295b.png#align=left&amp;display=inline&amp;height=98&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=156&amp;originWidth=948&amp;size=18271&amp;status=done&amp;style=none&amp;width=594" alt="image.png" class="inline"/> <img src="https://intranetproxy.alipay.com/skylark/lark/0/2021/gif/106133/1616397018098-69979d7a-4abf-4cfb-b1f3-5f218c29512c.gif#align=left&amp;display=inline&amp;height=442&amp;margin=%5Bobject%20Object%5D&amp;name=%E5%9B%BE%E7%89%871.gif&amp;originHeight=1330&amp;originWidth=746&amp;size=506092&amp;status=done&amp;style=none&amp;width=248" alt="图片1.gif" class="inline"/> </p>
<h2><a class="anchor" id="autotoc_md911"></a>
4.3 编译，烧入，运行</h2>
<p>编译命令 </p><div class="fragment"><div class="line">...进入到目录/solution/flower_demo</div>
<div class="line">aos make</div>
</div><!-- fragment --><p> 代码烧写命令 </p><div class="fragment"><div class="line">aos burn</div>
</div><!-- fragment --><p> 串口输入配网指令 </p><div class="fragment"><div class="line">netmgr -t wifi -c {ssid} {password}</div>
<div class="line">例如 </div>
<div class="line">ssid:HaaS-test</div>
<div class="line">password:88888888</div>
<div class="line">netmgr -t wifi -c HaaS-test 88888888</div>
</div><!-- fragment --><p> 打印信息 <img src="https://intranetproxy.alipay.com/skylark/lark/0/2021/png/106133/1616134364462-49c6de19-4bdc-411a-9d0c-5d2fa856161b.png#align=left&amp;display=inline&amp;height=365&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=900&amp;originWidth=958&amp;size=280445&amp;status=done&amp;style=none&amp;width=388" alt="image.png" class="inline"/> </p>
<h1><a class="anchor" id="autotoc_md912"></a>
5. 总结</h1>
<p>至此，一个简单的能手机远程管理的HaaS花卉养植系统就做好了。是不是很简单？</p>
<p>当然，这个HaaS花卉养植系统的打造仅仅是一个抛砖引玉，还有很大的扩展空间，比如 湿度过低触发自动洒水，温度过高自动开家里的空调等设备。还有非常大的想象和发挥空间。</p>
<p>同理，做一个 HaaS家庭鱼缸 远程监测包括喂食 等系统，也就很简单了。</p>
<p>另外，也希望大家能一起携手来丰富Haas的应用案例化，打造出更多更有意思的场景，比如：HaaS+人感打造智慧办公室、HaaS+Mic/Speaker打造和谐校园、HaaS+空净打造呼吸守护系统等等。 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
  </ul>
</div>
</body>
</html>
